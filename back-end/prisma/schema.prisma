// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Product {
  code        Int     @id @default(autoincrement())
  name        String
  sellPrice   Decimal @map("sell_price")
  stockAmount Int     @map("stock_amount")

  // A sale can have many products sold (with quantity and discounts)
  productSold ProductSold[]

  @@map("products")
}

model Sale {
  code      Int      @id @default(autoincrement()) // Unique identifier for each sale
  numItems  Int      @map("num_items") // Quantity of the product sold
  totalPaid Float    @map("total_paid") // Total value of the sale (sum of all products sold in this sale)
  timestamp DateTime @default(now()) // Date when the sale happened

  // A sale can have many products sold (with quantity and discounts)
  productSold ProductSold[]

  payment      Payment?  @relation(name: "payment_to_sale")
  customerCode Int
  customer     Customer? @relation(name: "customer_to_sale", fields: [customerCode], references: [code])

  @@map("sales")
}

model ProductSold {
  id          Int      @id @default(autoincrement()) // Unique identifier for each entry
  productCode Int      @map("product_code") // Foreign key to Product
  saleCode    Int      @map("sale_code") // Foreign key to Sale
  numItems    Int      @map("num_items") // Quantity of the product sold
  price       Float // Price at the time of sale
  discount    Float // Discount applied to the product (percentage or fixed value)
  valuePaid   Float    @map("value_paid") // Total price for this specific product in this sale (quantity * (price - discount))
  timestamp   DateTime @default(now()) // Date when the sale happened

  product Product @relation(fields: [productCode], references: [code])
  sale    Sale    @relation(fields: [saleCode], references: [code])

  @@map("products_sold")
}

model Customer {
  code Int    @id @default(autoincrement()) // Unique identifier for each entry
  name String

  purchases Sale[] @relation(name: "customer_to_sale")

  phoneNumber    String? @map("phone_number")
  address        String?
  identification String?

  @@map("customers")
}

model Payment {
  code   Int    @id @default(autoincrement()) // Unique identifier for each entry
  method String

  saleCode Int  @unique @map("sale_code")
  sale     Sale @relation(name: "payment_to_sale", fields: [saleCode], references: [code])

  @@map("payments")
}
